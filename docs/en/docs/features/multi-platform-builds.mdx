import {PackageManagerTabs} from '@theme'
import {AvatarEmoji} from '../../../../theme/components/avatar-emoji'

<AvatarEmoji emoji="package" />

# Multi-platform builds

Build and package the same extension for multiple browsers with predictable outputs.

Ship the same extension to Chrome, Edge, and Firefox without maintaining separate build scripts. Extension.js can run production builds per target, write artifacts to `dist/<browser>`, and optionally generate zip packages for distribution.

## How it works

Run a production build:

<PackageManagerTabs
  command={{
    npm: 'npx extension build',
    pnpm: 'pnpx extension build',
    yarn: 'yarn dlx extension build'
  }}
/>

Default browser target is `chromium` unless overridden.

{/* VIDEO_PLACEHOLDER: Show a default production build and where output appears under `dist/`. */}
![Video placeholder: default multi-platform build](https://placehold.co/960x540?text=Video+placeholder)

## Browser selection

You can target a specific browser/engine:

<PackageManagerTabs
  command={{
    npm: 'npx extension build --browser=chrome',
    pnpm: 'pnpx extension build --browser=chrome',
    yarn: 'yarn dlx extension build --browser=chrome'
  }}
/>

<PackageManagerTabs
  command={{
    npm: 'npx extension build --browser=firefox',
    pnpm: 'pnpx extension build --browser=firefox',
    yarn: 'yarn dlx extension build --browser=firefox'
  }}
/>

Supported values include:

- `chrome`
- `edge`
- `firefox`
- `chromium`
- `chromium-based`
- `gecko-based` / `firefox-based` (aliases)

You can also run a build matrix in one command:

<PackageManagerTabs
  command={{
    npm: 'npx extension build --browser=chrome,edge,firefox',
    pnpm: 'pnpx extension build --browser=chrome,edge,firefox',
    yarn: 'yarn dlx extension build --browser=chrome,edge,firefox'
  }}
/>

This builds sequentially for `chrome`, `edge`, and `firefox`.

{/* VIDEO_PLACEHOLDER: Show one command building `chrome`, `edge`, and `firefox` with separate outputs. */}
![Video placeholder: browser matrix build flow](https://placehold.co/960x540?text=Video+placeholder)

## Output layout

Each target writes to its own folder:

- `dist/chrome`
- `dist/edge`
- `dist/firefox`
- `dist/chromium`
- `dist/chromium-based`
- `dist/gecko-based`

### Build capabilities

| Option                  | What it does                                                                         |
| ----------------------- | ------------------------------------------------------------------------------------ |
| `--browser=<target>`    | Builds for a specific browser or engine family.                                      |
| `--zip`                 | Creates a distribution zip per target output.                                        |
| `--zip-filename=<name>` | Overrides the default zip file name.                                                 |
| `--zip-source`          | Creates a source archive alongside output.                                           |
| `--polyfill`            | Enables compatibility behavior for `browser.*` API usage in Chromium-family targets. |

{/* VIDEO_PLACEHOLDER: Show final `dist/<browser>` folder layout after a matrix build. */}
![Video placeholder: output layout by browser](https://placehold.co/960x540?text=Video+placeholder)

## Generating a zip file

Generate a distribution zip from each target output with `--zip`:

<PackageManagerTabs
  command={{
    npm: 'npx extension build --zip',
    pnpm: 'pnpx extension build --zip',
    yarn: 'yarn dlx extension build --zip'
  }}
/>

By default, the zip name uses sanitized manifest `name` + `version`, for example:

- `my-extension-1.0.0.zip`

Customize filename:

<PackageManagerTabs
  command={{
    npm: 'npx extension build --zip --zip-filename=my-release',
    pnpm: 'pnpx extension build --zip --zip-filename=my-release',
    yarn: 'yarn dlx extension build --zip --zip-filename=my-release'
  }}
/>

This creates `my-release.zip` inside the target `dist/<browser>` folder.

{/* VIDEO_PLACEHOLDER: Show zip output generation with default and custom `--zip-filename` values. */}
![Video placeholder: zip packaging workflow](https://placehold.co/960x540?text=Video+placeholder)

## Include source archive

Use `--zip-source` to generate a source archive alongside distribution output.

`--zip-source` produces:

- `dist/<name>-<version>-source.zip`

{/* VIDEO_PLACEHOLDER: Show source archive generation and where `-source.zip` is written. */}
![Video placeholder: source archive output](https://placehold.co/960x540?text=Video+placeholder)

## Polyfill support

If your code relies on Gecko-style `browser.*` APIs and you need Chromium compatibility, enable `--polyfill`:

<PackageManagerTabs
  command={{
    npm: 'npx extension build --polyfill',
    pnpm: 'pnpx extension build --polyfill',
    yarn: 'yarn dlx extension build --polyfill'
  }}
/>

{/* VIDEO_PLACEHOLDER: Show `--polyfill` build output for Chromium target when using `browser.*` in code. */}
![Video placeholder: polyfill build behavior](https://placehold.co/960x540?text=Video+placeholder)

## Best practices

- **Build per target in CI**: Treat each browser output as an independent artifact.
- **Use a browser matrix command for parity checks**: Catch target-specific issues early in one pipeline step.
- **Package intentionally**: Use `--zip` for store uploads and `--zip-source` for traceable source artifacts.
- **Keep target config explicit**: Use `extension.config.*` command/browser defaults for reproducible builds.

## Next steps

- Learn more about the [Browsers Available](../browsers/browsers-available.mdx).
- Explore [Path Resolution](./path-resolution.mdx) for asset/output mapping details.
